# 室內設計公司應用系統 - 需求規格文件 (Re-consolidated Specification)

**版本：** 3.0
**日期：** 2026-02-04
**狀態：** 已確認 (開發中)

---

## 1. 文件概述

### 1.1 目的
本文件定義「L'Atelier OS」室內設計公司應用系統的功能需求與技術規格，融合了原始需求與已實作的架構決策，作為後續 Phase 6+ 開發的基礎依據。

### 1.2 範圍
本系統涵蓋室內設計公司日常營運所需的核心功能，包括 AI 輔助估價、專案管理、財務與工班調度。

### 1.3 目標使用者
| 角色 | 說明 |
|------|------|
| **管理員 (Admin)** | 系統設定、權限管理、全域資料存取 |
| **設計師 (Designer)** | 專案執行、圖檔上傳、AI 估價製作 |
| **老闆 (Boss/Financial)** | 財務審核、專案毛利監控 |
| **工班 (Crew)** | (未來規劃) 工作派遣查看、進度回報 |

---

## 2. 系統架構 (已實作)

*   **框架**：Next.js 15 (React 19) + TypeScript
*   **介面**：Tailwind CSS + CSS Modules (L'Atelier Design System)
*   **資料庫**：PostgreSQL (via Prisma ORM)
*   **認證**：NextAuth.js v5 (Google OAuth)
*   **AI 核心**：OpenAI GPT-4o Vision API
*   **國際化**：next-intl (支援 zh-TW / en)

```
┌─────────────────────────────────────────────────────────┐
│                      前端介面 (Next.js)                  │
│           (響應式網頁 / Project / Contract UI)           │
├─────────────────────────────────────────────────────────┤
│                      API Routes                          │
├──────┬──────┬──────┬──────┬──────┬──────┬──────┬───────┤
│ 權限 │ 專案 │ 圖檔 │ 估價 │ 工班 │ 財務 │ 提醒 │ 報表  │
│ Auth │ Proj │ AI   | Quote| Crew | Fin  | Noti | Rep   │
├──────┴──────┴──────┴──────┴──────┴──────┴──────┴───────┤
│                    PostgreSQL / Blob Storage            │
└─────────────────────────────────────────────────────────┘
```

---

## 3. 功能需求與實作狀態

### 3.1 人員權限管理
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| UM-01 | 使用者登入 | Google OAuth 一鍵登入 | ✅ 已完成 (Phase 1) |
| UM-02 | 權限角色 | 區分 Admin/User，未來擴充 Crew | ✅ 已完成 (基礎) |
| UM-03 | 資料存取 | 依專案指派顯示內容 | ✅ 已完成 |

### 3.2 主頁與儀表板 (Dashboard)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| DB-01 | 專案概覽 | 顯示專案列表與狀態標籤 | ✅ 已完成 |
| DB-02 | 財務摘要 | 本月營收/支出/專案毛利 | ⏳ (Phase 6.1) |
| DB-03 | 待辦事項 | 個人待處理清單 | ⏳ (待規劃) |

### 3.3 專案管理 (Project Management)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| PM-01 | 專案建立 | 建立專案、客戶資訊關聯 | ✅ 已完成 |
| PM-02 | 專案列表 | 搜尋、篩選、分頁 | ✅ 已完成 |
| PM-03 | 專案詳情 | 整合 AI 估價、合約、工作流 | ✅ 已完成 |
| PM-04 | 狀態流轉 | 洽談→設計→合約→施工 | ✅ 已完成 (Workflow) |

### 3.4 智慧圖檔與 AI 估價 (AI Core)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| AI-01 | 平面圖分析 | 上傳平面圖，AI 識別空間與物件 | ✅ 已完成 (GPT-4o) |
| AI-02 | 自動估價 | 根據 AI 識別結果對應工項單價 | ✅ 已完成 |
| AI-03 | 互動修正 | 對話式調整估價內容 | ✅ 已完成 |
| AI-04 | 工項資料庫 | 管理標準單價 (Item Library) | ✅ 已完成 (Phase 5) |

### 3.5 估價與合約 (Quotation & Contract)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| QT-01 | 估價單生成 | AI 自動生成與手動調整 | ✅ 已完成 |
| QT-02 | 合約預覽 | 根據估價單即時生成合約 (PDF) | ✅ 已完成 |
| QT-03 | 合約輸出 | 列印/匯出 PDF 功能 | ✅ 已完成 |

### 3.6 工班管理 (Crew Management)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| WC-01 | 工班資料庫 | 登記工班資訊與專長 | ⏳ (Phase 6.2) |
| WC-02 | 工班排程 | 甘特圖排程 (Gantt Chart) | ⏳ (Phase 6.2) |
| WC-03 | 衝突檢查 | 自動提醒排程衝突 | ⏳ (Phase 6.2) |

### 3.7 財務管理 (Finance)
| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| FN-01 | 收支登記 | 記錄每筆專案的實收實付 | ⏳ (Phase 6.1) |
| FN-02 | 專案損益 | 視覺化圖表分析專案毛利 | ⏳ (Phase 6.1) |
| FN-03 | 財務報表 | 季/年度全域報表 | ⏳ (Phase 6.1) |

### 3.8 全方位工單/待辦系統 (Universal Task & Issue Tracker) - Expanded!
此模組不限於施工缺失，而是作為全案協作的核心樞紐。支援將「待辦事項」或「問題單」分派給專案中的任何角色。

| 編號 | 功能 | 說明 | 實作狀態 |
|------|------|------|--------|
| IS-01 | 跨角色指派 | 可指派給 **客戶** (如: 選磚)、**設計師** (如: 改圖)、**工班** (如: 修補) | ⏳ (Phase 6.3) |
| IS-02 | 權限分流 | 客戶僅能看到與自己相關的待辦；內部人員可見全貌 | ⏳ (Phase 6.3) |
| IS-03 | 多元類型 | 區分：施工缺失、待確認事項、行政工單、客戶需求 | ⏳ (Phase 6.3) |
| IS-04 | 全局看板 | 統一的 Kanban 介面，依狀態 (To Do / In Progress / Done) 管理所有事務 | ⏳ (Phase 6.3) |
| IS-05 | 處理歷程 | 完整的留言與歷程記錄 (Audit Trail)，責任歸屬清晰 | ⏳ (Phase 6.3) |

---

## 4. 系統需求規格

### 4.1 效能需求
*   **頁面載入**：< 1.5 秒 (Next.js Server Components 優化)
*   **AI 回應**：預期 3~5 秒 (視 OpenAI API 狀態，具備 Loading 狀態提示)

### 4.2 部署架構
*   **前端/API**：Node.js Runtime (Local or Vercel)
*   **資料庫**：PostgreSQL (Local Docker or Neon/Supabase)
*   **圖檔儲存**：目前使用本地 `/public`，生產環境建議改為 AWS S3 / Vercel Blob。

---

## 5. 資料庫模型 (更新版)

基於目前已實作的 Prisma Schema：

```prisma
model User          // 員工帳號 (NextAuth)
model Project       // 專案主檔
model Client        // 客戶資料
model Quotation     // 估價單 (關聯 AI 產出)
model ItemLibrary   // 工項單價庫 (AI 參照來源)
model Workflow      // 審核流程設定
model FinanceRecord // (規劃中) 財務收支
model Schedule      // (規劃中) 施工排程
model WorkCrew      // (規劃中) 工班資料
model Issue         // (規劃中) 工程問題單
model IssueComment  // (規劃中) 問題單討論紀錄
```

---

## 6. 下一步開發建議 (Phase 6 Roadmap)

依據複測結果與需求缺口，建議優先順序如下：

1.  **財務儀表板 (Financial Dashboard)**：補足「經營管理」視角，讓估價單不再只是報價工具，而是利潤分析的基礎。
2.  **施工甘特圖 (Construction Gantt)**：補足「專案執行」視角，管理工班與進度。
3.  **工程問題單 (Issue Tracker)**：**新增！** 類似 Jira 的施工缺失管理與工種待辦追蹤。
4.  **行動版優化**：針對平板裝置優化現場操作體驗。

---

*本文件已根據實際且已驗證的系統狀態由 L'Atelier AI 助手更新。*
